

# تحسين ملخص متوسطات الأسئلة وتفعيل الملخص التنفيذي في PDF

## المشكلات الحالية

1. **ملخص متوسطات الأسئلة**: يتم التقاطه كصورة (screenshot) من الشاشة مما يجعل البيانات غير واضحة في PDF. لا توجد أرقام أو تسميات واضحة على الأعمدة
2. **الملخص التنفيذي**: يظهر نص "لا يوجد ملخص تنفيذي" لأن البيانات لا تُحمّل بشكل صحيح أو لم يتم توليدها بعد

## التغييرات المطلوبة

### ملف واحد: `src/utils/exportReport.ts`

### 1. استبدال صورة ملخص المتوسطات برسم برمجي واضح

بدلا من التقاط صورة للمخطط من الشاشة (السطور 396-416)، سيتم رسم مخطط أعمدة أفقي (Horizontal Bar Chart) برمجيا لجميع الأسئلة مع:

- اسم مختصر لكل سؤال (س1، س2...) على اليمين
- شريط أفقي ملون حسب مستوى الأداء (أخضر للممتاز، أصفر للمتوسط، أحمر للضعيف)
- قيمة المتوسط مكتوبة بوضوح على الشريط أو بجانبه
- خط مرجعي عند القيمة 3.0 (المتوسط)
- مقياس من 0 إلى 5 في الأسفل
- مفتاح الألوان (Legend) يوضح مستويات الأداء

### 2. تفعيل الملخص التنفيذي

- في `preparePDFData` بملف Reports.tsx: التأكد من تمرير `report.summary` بشكل صحيح
- إضافة نص افتراضي مُولّد تلقائيا من الإحصائيات إذا لم يوجد ملخص من AI:
  - يتضمن: عدد الاستجابات، المتوسط العام، أعلى وأدنى سؤال تقييما
  - هذا يضمن وجود ملخص دائما حتى لو لم يتم استخدام "إعادة التحليل"

## التفاصيل التقنية

### رسم ملخص المتوسطات الجديد

دالة جديدة `drawSummaryBarChart` ستستبدل صورة الملخص:

- تأخذ قائمة `questionStats` وتعرض فقط أسئلة ليكرت/تقييم
- لكل سؤال: شريط أفقي بعرض يتناسب مع المتوسط (من 0 إلى 5)
- الألوان: أخضر غامق (4.5+)، أخضر فاتح (3.5-4.5)، أصفر (2.5-3.5)، برتقالي (1.5-2.5)، أحمر (أقل من 1.5)
- قيمة المتوسط مكتوبة بخط واضح (حجم 9) داخل أو بجانب الشريط
- تسمية السؤال على اليمين
- ارتفاع ديناميكي حسب عدد الأسئلة مع دعم تعدد الصفحات

### توليد ملخص تنفيذي تلقائي

في دالة `buildPDFDocument`، قبل قسم الملخص التنفيذي:
- إذا كان `report.summary` فارغا، يتم توليد ملخص من البيانات الإحصائية
- يشمل: "بلغ إجمالي الاستجابات X، بمتوسط عام Y/5 (مستوى Z). أعلى سؤال تقييما: ... أدنى سؤال: ..."

### الملفات المعدلة

| الملف | التغيير |
|-------|---------|
| `src/utils/exportReport.ts` | استبدال صورة الملخص برسم برمجي + توليد ملخص تلقائي |
| `src/pages/Reports.tsx` | لا تغيير (البيانات تُمرر بشكل صحيح حاليا) |

### لا تعديل على قاعدة البيانات
