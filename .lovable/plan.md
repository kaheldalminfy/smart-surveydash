

# تطوير شاشة مقارنة البرامج الأكاديمية

## الوضع الحالي
شاشة المقارنة الحالية بسيطة جدا: تختار برامج وتضغط مقارنة فتحصل على متوسط عام فقط بدون تصنيف حسب نوع الاستبيان او السنة الاكاديمية.

## التصميم الجديد

### 1. فلاتر ذكية في الاعلى
- **العام الاكاديمي**: قائمة منسدلة لاختيار سنة محددة (مثل 2025-2026) - اجباري
- **الفصل الدراسي**: اختياري (خريف / ربيع / جميع الفصول)
- **اختيار البرامج**: كما هو حاليا مع اضافة بادجات ملونة لكل برنامج

### 2. منطق المقارنة الذكي
بعد اختيار البرامج والسنة، يتم:
- جلب جميع الاستبيانات لكل برنامج في تلك السنة/الفصل
- **تصنيف الاستبيانات بالعنوان**: مطابقة الاستبيانات المتشابهة بين البرامج (مثلا "تقييم الطلاب للمقرر" في برنامج ادارة الاعمال مع نظيره في برنامج ادارة الرعاية الصحية)
- حساب المتوسط العام لكل استبيان في كل برنامج

### 3. العرض البصري

#### قسم 1: ملخص الاداء العام (KPI Cards)
- بطاقة لكل برنامج تحتوي على: عدد الاستبيانات، اجمالي الاستجابات، المتوسط العام، نسبة الرضا
- تمييز البرنامج الافضل بايقونة نجمة

#### قسم 2: مقارنة حسب نوع الاستبيان (المخطط الرئيسي)
- **Grouped Bar Chart**: لكل نوع استبيان (تقييم طالب للمقرر، تقييم عضو هيئة تدريس، رضا عن الامتحان...) يظهر عمود لكل برنامج جنبا الى جنب
- كل برنامج بلون مختلف ثابت
- الاستبيانات الموجودة في برنامج واحد فقط تظهر بعمود واحد مع ملاحظة "غير متوفر" للبرنامج الاخر

#### قسم 3: مخطط رادار شامل
- Radar Chart يقارن الاداء في كل محور (نوع استبيان) بين البرامج المختارة
- كل برنامج بخط مختلف اللون مع شفافية للتعبئة

#### قسم 4: جدول تفصيلي
- جدول يعرض كل نوع استبيان مع المتوسط لكل برنامج والفرق بينهما
- تلوين الفرق (اخضر اذا ايجابي، احمر اذا سلبي)
- علامة "-" للاستبيانات غير المتوفرة في برنامج معين

---

## التفاصيل التقنية

### ملف واحد: `src/components/ProgramComparison.tsx` (اعادة كتابة)

### هيكل البيانات الجديد

```text
State:
- selectedAcademicYear: string (اجباري)
- selectedSemester: string (اختياري)
- selectedPrograms: string[] (برنامجين او اكثر)
- comparisonResult: {
    programs: Array<{ id, name, color }>
    surveyTypes: Array<{
      title: string (اسم نوع الاستبيان المشترك)
      programData: Array<{
        programId: string
        programName: string
        averageScore: number
        responseCount: number
        exists: boolean
      }>
    }>
    overallComparison: Array<{ programName, overallMean, totalResponses, totalSurveys }>
  }
```

### منطق مطابقة الاستبيانات

```text
1. جلب الاستبيانات مع الاستجابات والاجابات لكل برنامج
2. تجميع الاستبيانات حسب "النوع" باستخدام كلمات مفتاحية في العنوان:
   - "تقييم الطلاب للمقرر" / "تقييم المقرر" -> "رضا الطلاب عن المقررات"
   - "عضو هيئة التدريس" -> "رضا اعضاء هيئة التدريس"
   - "الامتحان النهائي" -> "رضا الطلاب عن الامتحان النهائي"
   - "تقييم الخريج" -> "تقييم الخريجين"
   - "ورشة عمل" -> "تقييم ورش العمل"
   - اي عنوان اخر يبقى كما هو
3. لكل فئة: حساب المتوسط من جميع اجابات الليكرت والتقييم (1-5 فقط)
4. بناء بيانات المقارنة: لكل فئة تظهر في اي برنامج، اظهار القيمة او "غير متوفر"
```

### الالوان الثابتة للبرامج

```text
PROGRAM_COLORS = [
  '#3b82f6' (ازرق),
  '#ef4444' (احمر),
  '#10b981' (اخضر),
  '#f59e0b' (برتقالي),
  '#8b5cf6' (بنفسجي)
]
كل برنامج يأخذ لونا ثابتا حسب ترتيب الاختيار
```

### المخططات

```text
1. Grouped BarChart:
   - XAxis: اسماء فئات الاستبيانات
   - لكل برنامج: Bar بلون مختلف
   - YAxis: من 0 الى 5
   - Tooltip يعرض اسم البرنامج والمتوسط وعدد الاستجابات

2. RadarChart:
   - PolarAngleAxis: اسماء فئات الاستبيانات
   - لكل برنامج: Radar بلون مختلف مع fillOpacity 0.3
   - PolarRadiusAxis: من 0 الى 5

3. جدول المقارنة التفصيلي:
   - عمود لاسم الفئة
   - عمود لكل برنامج (المتوسط)
   - عمود الفرق (اذا برنامجين فقط)
```

### العام الاكاديمي
- استخراج السنوات المتاحة من الاستبيانات الموجودة فعلا في قاعدة البيانات
- عرضها في قائمة منسدلة

### لا تعديل على قاعدة البيانات
- لا حذف لاي بيانات
- لا تغيير في هيكل الجداول
- جميع التغييرات في الواجهة الامامية فقط

### ملخص الملفات

| الملف | التغيير |
|-------|---------|
| `src/components/ProgramComparison.tsx` | اعادة بناء كاملة مع فلاتر ذكية ومقارنة حسب نوع الاستبيان ومخططات متعددة |

