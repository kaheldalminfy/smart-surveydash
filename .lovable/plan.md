
# تنظيم صفحة الاستبيانات حسب البرامج مع بحث وتصفية داخلية

## الهدف
تجميع الاستبيانات في صفحة `/surveys` حسب البرنامج باستخدام Accordion، مع إضافة بحث داخلي لكل برنامج وتصفية حسب الحالة (نشط / مسودة / مغلق). الحفاظ على جميع الأزرار والوظائف الحالية بدون أي تعديل على قاعدة البيانات.

---

## التغييرات

### ملف واحد فقط: `src/pages/Surveys.tsx`

### 1. إضافة استيرادات جديدة
- `useMemo` من React
- `Accordion, AccordionItem, AccordionTrigger, AccordionContent` من مكونات UI
- أيقونة `Filter` من lucide-react

### 2. إضافة حالات جديدة (State)
- `searchQuery`: بحث عام في أعلى الصفحة (الموجود حاليا لكن غير مربوط)
- `programSearchQueries`: كائن يحفظ نص البحث الخاص بكل برنامج `Record<string, string>`
- `programStatusFilters`: كائن يحفظ فلتر الحالة لكل برنامج `Record<string, 'all' | 'active' | 'draft' | 'closed'>`

### 3. تجميع الاستبيانات حسب البرنامج
- استخدام `useMemo` لإنشاء `groupedSurveys`:
  - تصفية عامة حسب `searchQuery`
  - تجميع حسب `survey.programs?.name || "بدون برنامج"`
  - ترتيب البرامج أبجديا

### 4. تعديل عرض تبويب "الاستبيانات"
- استبدال القائمة المسطحة بـ `Accordion` من نوع `type="multiple"` (لفتح عدة برامج في نفس الوقت)
- كل `AccordionItem` يمثل برنامج ويعرض:
  - **العنوان**: اسم البرنامج + Badge بعدد الاستبيانات
  - **داخل AccordionContent**:
    - شريط بحث خاص بالبرنامج
    - أزرار تصفية حسب الحالة (الكل | نشط | مسودة | مغلق) باستخدام Tabs صغيرة
    - بطاقات الاستبيانات المصفاة بنفس التصميم والأزرار الحالية تماما

### 5. الحفاظ الكامل على الوظائف
- جميع الأزرار تبقى كما هي: إيقاف/تفعيل، تعديل، QR، رابط، التقرير، حذف
- حوارات الحذف والـ QR تعمل بنفس الطريقة
- تبويب النماذج (templates) يبقى كما هو بدون تغيير
- لا تعديل على قاعدة البيانات

---

## التفاصيل التقنية

### البنية الجديدة للعرض

```text
البحث العام (موجود حاليا - يتم ربطه)
    |
    v
Accordion (type="multiple")
  |
  +-- AccordionItem: "برنامج القانون" (3 استبيانات)
  |     +-- [بحث داخلي] [الكل | نشط | مسودة | مغلق]
  |     +-- بطاقة استبيان 1 (مع كل الأزرار)
  |     +-- بطاقة استبيان 2
  |     +-- بطاقة استبيان 3
  |
  +-- AccordionItem: "برنامج التسويق" (2 استبيانات)
  |     +-- [بحث داخلي] [الكل | نشط | مسودة | مغلق]
  |     +-- بطاقة استبيان 1
  |     +-- بطاقة استبيان 2
  |
  +-- ... باقي البرامج
```

### منطق التصفية

كل برنامج يطبق فلترين متتاليين:
1. فلتر البحث الداخلي: يبحث في عنوان الاستبيان
2. فلتر الحالة: يعرض فقط الاستبيانات بالحالة المختارة (أو الكل)

البحث العام في أعلى الصفحة يصفي عبر جميع البرامج، والبرامج التي لا تحتوي نتائج بعد التصفية لا تظهر.

### الملخص
| العنصر | التغيير |
|--------|---------|
| الملفات المعدلة | `src/pages/Surveys.tsx` فقط |
| قاعدة البيانات | لا تغيير |
| الوظائف الحالية | محفوظة بالكامل |
| إضافات جديدة | تجميع حسب البرنامج + بحث داخلي + تصفية حسب الحالة |
