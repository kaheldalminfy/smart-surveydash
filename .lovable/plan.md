

# خطة تحديث لوحة تحكم البرامج

## ملخص التغييرات (بدون أي تعديل في قاعدة البيانات)

جميع التعديلات ستكون في الواجهة الأمامية فقط (قراءة بيانات فقط من قاعدة البيانات).

---

## 1. إصلاح أيقونة اسم البرنامج

**المشكلة**: جميع البرامج تعرض حرف "ب" لأن أسماءها تبدأ بكلمة "برنامج".

**الحل**: استخراج الاسم الفعلي بعد كلمة "برنامج" وعرض الحرف الأول منه.
- مثال: "برنامج القانون" يعرض "ق"
- مثال: "برنامج التسويق" يعرض "ت"

**الملف**: `src/components/dashboard/ProgramSection.tsx` - السطر 102

---

## 2. إضافة تفاصيل الاستبيانات والشكاوى القابلة للتوسيع

### توسيع البيانات المحملة في `RoleBasedDashboard.tsx`

تعديل `loadProgramStats` لتحميل بيانات إضافية (قراءة فقط):
- **قائمة الاستبيانات**: اسم كل استبيان + عدد الاستجابات + المتوسط الخاص به + رابط للتقرير
- **قائمة الشكاوى**: موضوع كل شكوى + حالتها + تاريخها + رابط للتفاصيل

توسيع interface `ProgramStats`:
```text
surveyDetails: Array<{ id, title, responseCount, avgSatisfaction }>
complaintDetails: Array<{ id, subject, status, createdAt, complainantType }>
```

### تعديل واجهة `ProgramSection.tsx`

- إضافة أيقونات قابلة للنقر (Collapsible) في بطاقات KPI:
  - عند الضغط على بطاقة "الاستبيانات" تظهر قائمة بجميع الاستبيانات مع تفاصيلها وروابط للدخول عليها (`/surveys` أو `/reports`)
  - عند الضغط على بطاقة "الشكاوى" تظهر قائمة بجميع الشكاوى مع تفاصيلها ورابط للدخول (`/complaints`)
- كل عنصر في القائمة سيكون رابطاً قابلاً للنقر للانتقال لصفحة التفاصيل

---

## 3. تصحيح حساب المتوسط العام

**المشكلة الحالية**: يحسب متوسط جميع الإجابات الرقمية معاً مما يعطي انطباعاً بالضعف.

**الحل**: حساب المتوسط لكل استبيان/مقرر بشكل منفصل، ثم المتوسط العام يكون "متوسط المتوسطات" وهو أكثر عدالة ودقة.

---

## التفاصيل التقنية

### الملفات المعدلة

| الملف | التعديل |
|-------|---------|
| `src/components/dashboard/RoleBasedDashboard.tsx` | توسيع `ProgramStats` interface + تعديل `loadProgramStats` لتحميل تفاصيل الاستبيانات والشكاوى + تصحيح حساب المتوسط |
| `src/components/dashboard/ProgramSection.tsx` | إصلاح أيقونة الاسم + إضافة أقسام قابلة للتوسيع للاستبيانات والشكاوى مع روابط |

### تفاصيل تعديل `RoleBasedDashboard.tsx`

1. توسيع `ProgramStats` بإضافة:
   - `surveyDetails`: قائمة الاستبيانات مع (id, title, responseCount, avgSatisfaction)
   - `complaintDetails`: قائمة الشكاوى مع (id, subject, status, createdAt, complainantType)

2. في `loadProgramStats`:
   - تحميل بيانات الاستبيانات مع عناوينها وحساب متوسط كل استبيان منفرداً
   - تحميل تفاصيل الشكاوى (subject, status, created_at, complainant_type)
   - حساب `averageSatisfaction` كمتوسط المتوسطات بدلاً من متوسط كل الإجابات

### تفاصيل تعديل `ProgramSection.tsx`

1. استيراد `useState` و `Link` من react-router-dom
2. تعديل السطر 102: `stats.programName.replace(/^برنامج\s*/, '').charAt(0)` أو الحرف الأول إن لم يبدأ بـ "برنامج"
3. إضافة حالات محلية `showSurveys` و `showComplaints` (useState)
4. تحويل بطاقتي "الاستبيانات" و"الشكاوى" لتكون قابلة للنقر مع أيقونة سهم
5. عند النقر تظهر قائمة تفصيلية:
   - **الاستبيانات**: جدول صغير (اسم الاستبيان | عدد الاستجابات | المتوسط) مع رابط لكل استبيان
   - **الشكاوى**: جدول صغير (الموضوع | الحالة | التاريخ) مع رابط لكل شكوى

