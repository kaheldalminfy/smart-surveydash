

# اضافة تقرير شامل عند تنزيل PDF بدون فلتر

## الفكرة
عند الضغط على زر PDF:
- **بدون فلتر**: تقرير شامل يتضمن جدول بجميع المقررات الدراسية ومتوسطاتها + المتوسط العام لكل سؤال
- **مع فلتر (مقرر محدد)**: التقرير التفصيلي الحالي لكل مقرر (بدون تغيير)

## التغييرات المطلوبة

### ملف 1: `src/pages/Reports.tsx`

**في `preparePDFData`:**
- عند عدم وجود فلتر، حساب بيانات كل مقرر دراسي على حدة:
  - تحديد سؤال المقرر الدراسي (نوع mcq الذي يحتوي على اسماء المقررات)
  - لكل قيمة فريدة (اسم مقرر): تصفية الاستجابات وحساب المتوسط العام والعدد
  - تمرير هذه البيانات كـ `coursesSummary` ضمن `stats`

**في `buildFilterInfo`:**
- اذا لم يكن هناك فلتر مختار، ارجاع `filterInfo` بدون `courseName` (كما هو حاليا)

**بنية بيانات المقررات الجديدة:**
```text
coursesSummary: Array<{
  courseName: string;
  responseCount: number;
  overallMean: number;
  questionMeans: Array<{ question: string; mean: number }>
}>
```

### ملف 2: `src/utils/exportReport.ts`

**في `buildPDFDocument`:**
- اضافة شرط: اذا لم يكن هناك `filterInfo?.courseName` وكان `stats.coursesSummary` موجودا:
  - بعد KPIs وجدول الاحصائيات مباشرة، رسم قسم جديد "ملخص المقررات الدراسية"
  - جدول يحتوي على: اسم المقرر | عدد الاستجابات | المتوسط العام | مستوى الاداء
  - الوان حسب مستوى الاداء لكل مقرر

**بقية التقرير الشامل تبقى كما هي:**
- ملخص متوسطات الاسئلة (المتوسط العام لجميع الاستجابات)
- تحليل كل سؤال بالـ Bar Charts
- الملخص التنفيذي والتوصيات

### لا تعديل على قاعدة البيانات
- لا حذف لاي بيانات
- لا تغيير في هيكل الجداول
- البيانات تحسب من الاستجابات الموجودة فقط

## التفاصيل التقنية

### حساب بيانات المقررات في Reports.tsx

في `preparePDFData`، عند عدم وجود فلتر:
1. البحث عن سؤال من نوع `mcq` يمثل المقرر الدراسي (اول سؤال mcq او السؤال الذي يحتوي على كلمة "مقرر" في نصه)
2. استخراج القيم الفريدة من اجابات هذا السؤال = اسماء المقررات
3. لكل مقرر: تصفية الاستجابات + حساب متوسط الاسئلة الليكرت/التقييم
4. اضافة `coursesSummary` الى كائن `stats`

### رسم جدول المقررات في exportReport.ts

جدول autoTable جديد بعد الاحصائيات العامة:
- اعمدة: الترتيب | اسم المقرر | عدد الاستجابات | المتوسط | مستوى الاداء
- تلوين خلية المتوسط حسب المستوى (اخضر/اصفر/برتقالي/احمر)
- ترتيب المقررات من الاعلى للاقل متوسطا

### ملخص الملفات

| الملف | التغيير |
|-------|---------|
| `src/pages/Reports.tsx` | حساب ملخص المقررات عند عدم وجود فلتر وتمريره للـ PDF |
| `src/utils/exportReport.ts` | رسم جدول المقررات الدراسية في التقرير الشامل |
